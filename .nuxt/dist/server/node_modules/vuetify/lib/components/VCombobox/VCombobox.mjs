import{ref as e,shallowRef as l,computed as t,watch as o,nextTick as a,createVNode as u,mergeProps as n,Fragment as i,createTextVNode as r}from"/Users/alexandarvalov/Documents/GitHub/nzis-import-app/node_modules/vue/index.mjs";/* empty css              */import{makeSelectProps as v}from"../VSelect/VSelect.mjs";import{makeVTextFieldProps as s,VTextField as c}from"../VTextField/VTextField.mjs";import{useScrolling as m}from"../VSelect/useScrolling.mjs";import{useTextColor as p}from"../../composables/color.mjs";import{useFilter as d,makeFilterProps as f,highlightResult as b}from"../../composables/filter.mjs";import{useForm as h}from"../../composables/form.mjs";import{forwardRefs as x}from"../../composables/forwardRefs.mjs";import{useItems as V,transformItem as y}from"../../composables/list-items.mjs";import{useLocale as g}from"../../composables/locale.mjs";import{useProxiedModel as k}from"../../composables/proxiedModel.mjs";import{makeTransitionProps as j}from"../../composables/transition.mjs";import{VIcon as C}from"../VIcon/VIcon.mjs";import{VMenu as D}from"../VMenu/VMenu.mjs";import{VList as S}from"../VList/VList.mjs";import{VListItem as w}from"../VList/VListItem.mjs";import{VVirtualScroll as I}from"../VVirtualScroll/VVirtualScroll.mjs";import{VCheckboxBtn as A}from"../VCheckbox/VCheckboxBtn.mjs";import{VAvatar as _}from"../VAvatar/VAvatar.mjs";import{VChip as E}from"../VChip/VChip.mjs";import{VDefaultsProvider as P}from"../VDefaultsProvider/VDefaultsProvider.mjs";import{deepEqual as R,omit as F,wrapInArray as M,noop as T,ensureValidVNode as O,isComposingIgnoreKey as L,checkPrintable as U}from"../../util/helpers.mjs";import{genericComponent as B}from"../../util/defineComponent.mjs";import{propsFactory as K}from"../../util/propsFactory.mjs";import{useRender as N}from"../../util/useRender.mjs";const z=K({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...f({filterKeys:["title"]}),...v({hideNoData:!0,returnObject:!0}),...F(s({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...j({transition:!1})},"VCombobox"),H=B()({name:"VCombobox",props:z(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(v,s){var f;let{emit:j,slots:F}=s;const{t:B}=g(),K=e(),z=l(!1),H=l(!0),G=l(!1),$=e(),q=e(),J=l(-1);let Q=!1;const W=t((()=>{var e;return null==(e=K.value)?void 0:e.color})),{items:X,transformIn:Y,transformOut:Z}=V(v),{textColorClasses:ee,textColorStyles:le}=p(W),te=k(v,"modelValue",[],(e=>Y(M(e))),(e=>{const l=Z(e);return v.multiple?l:l[0]??null})),oe=h(v),ae=t((()=>!(!v.chips&&!F.chip))),ue=t((()=>ae.value||!!F.selection)),ne=l(v.multiple||ue.value?"":(null==(f=te.value[0])?void 0:f.title)??""),ie=t({get:()=>ne.value,set:e=>{var l;if(ne.value=e??"",v.multiple||ue.value||(te.value=[y(v,e)]),e&&v.multiple&&(null==(l=v.delimiters)?void 0:l.length)){const l=e.split(new RegExp(`(?:${v.delimiters.join("|")})+`));l.length>1&&(l.forEach((e=>{(e=e.trim())&&we(y(v,e))})),ne.value="")}e||(J.value=-1),H.value=!e}}),re=t((()=>"function"==typeof v.counterValue?v.counterValue(te.value):"number"==typeof v.counterValue?v.counterValue:v.multiple?te.value.length:ie.value.length)),{filteredItems:ve,getMatches:se}=d(v,X,(()=>H.value?"":ie.value)),ce=t((()=>v.hideSelected?ve.value.filter((e=>!te.value.some((l=>l.value===e.value)))):ve.value)),me=t((()=>v.hideNoData&&!ce.value.length||oe.isReadonly.value||oe.isDisabled.value)),pe=k(v,"menu"),de=t({get:()=>pe.value,set:e=>{var l;pe.value&&!e&&(null==(l=$.value)?void 0:l.Î¨openChildren.size)||e&&me.value||(pe.value=e)}}),fe=t((()=>de.value?v.closeText:v.openText));o(ne,(e=>{Q?a((()=>Q=!1)):z.value&&!de.value&&(de.value=!0),j("update:search",e)})),o(te,(e=>{var l;v.multiple||ue.value||(ne.value=(null==(l=e[0])?void 0:l.title)??"")}));const be=t((()=>te.value.map((e=>e.value)))),he=t((()=>{var e;return(!0===v.autoSelectFirst||"exact"===v.autoSelectFirst&&ie.value===(null==(e=ce.value[0])?void 0:e.title))&&ce.value.length>0&&!H.value&&!G.value})),xe=e(),Ve=m(xe,K);function ye(e){Q=!0,v.openOnClear&&(de.value=!0)}function ge(){me.value||(de.value=!0)}function ke(e){me.value||(z.value&&(e.preventDefault(),e.stopPropagation()),de.value=!de.value)}function je(e){var l;" "!==e.key&&U(e)&&(null==(l=K.value)||l.focus())}function Ce(e){var l,t,o,a;if(L(e)||oe.isReadonly.value)return;const u=null==(l=K.value)?void 0:l.selectionStart,n=te.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(de.value=!0),["Escape"].includes(e.key)&&(de.value=!1),["Enter","Escape","Tab"].includes(e.key)&&(he.value&&["Enter","Tab"].includes(e.key)&&!te.value.some((e=>{let{value:l}=e;return l===ce.value[0].value}))&&we(ve.value[0]),H.value=!0),"ArrowDown"===e.key&&he.value&&(null==(t=xe.value)||t.focus("next")),"Enter"===e.key&&ie.value&&(we(y(v,ie.value)),ue.value&&(ne.value="")),["Backspace","Delete"].includes(e.key)){if(!v.multiple&&ue.value&&te.value.length>0&&!ie.value)return we(te.value[0],!1);if(~J.value){e.preventDefault();const l=J.value;we(te.value[J.value],!1),J.value=l>=n-1?n-2:l}else"Backspace"!==e.key||ie.value||(J.value=n-1)}else if(v.multiple)if("ArrowLeft"===e.key){if(J.value<0&&u&&u>0)return;const e=J.value>-1?J.value-1:n-1;te.value[e]?J.value=e:(J.value=-1,null==(o=K.value)||o.setSelectionRange(ie.value.length,ie.value.length))}else if("ArrowRight"===e.key){if(J.value<0)return;const e=J.value+1;te.value[e]?J.value=e:(J.value=-1,null==(a=K.value)||a.setSelectionRange(0,0))}else~J.value&&U(e)&&(J.value=-1)}function De(){var e;v.eager&&(null==(e=q.value)||e.calculateVisibleItems())}function Se(){var e;z.value&&(H.value=!0,null==(e=K.value)||e.focus())}function we(e){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&!e.props.disabled)if(v.multiple){const t=te.value.findIndex((l=>(v.valueComparator||R)(l.value,e.value))),o=null==l?!~t:l;if(~t){const l=o?[...te.value,e]:[...te.value];l.splice(t,1),te.value=l}else o&&(te.value=[...te.value,e]);v.clearOnSelect&&(ie.value="")}else{const t=!1!==l;te.value=t?[e]:[],ne.value=t&&!ue.value?e.title:"",a((()=>{de.value=!1,H.value=!0}))}}function Ie(e){z.value=!0,setTimeout((()=>{G.value=!0}))}function Ae(e){G.value=!1}function _e(e){null!=e&&(""!==e||v.multiple||ue.value)||(te.value=[])}return o(z,((e,l)=>{if(!e&&e!==l&&(J.value=-1,de.value=!1,ie.value)){if(v.multiple)return void we(y(v,ie.value));if(!ue.value)return;te.value.some((e=>{let{title:l}=e;return l===ie.value}))?ne.value="":we(y(v,ie.value))}})),o(de,(()=>{!v.hideSelected&&de.value&&te.value.length&&ce.value.findIndex((e=>te.value.some((l=>(v.valueComparator||R)(l.value,e.value)))))})),o((()=>v.items),((e,l)=>{de.value||z.value&&!l.length&&e.length&&(de.value=!0)})),N((()=>{const e=!!(!v.hideNoData||ce.value.length||F["prepend-item"]||F["append-item"]||F["no-data"]),l=te.value.length>0,t=c.filterProps(v);return u(c,n({ref:K},t,{modelValue:ie.value,"onUpdate:modelValue":[e=>ie.value=e,_e],focused:z.value,"onUpdate:focused":e=>z.value=e,validationValue:te.externalValue,counterValue:re.value,dirty:l,class:["v-combobox",{"v-combobox--active-menu":de.value,"v-combobox--chips":!!v.chips,"v-combobox--selection-slot":!!ue.value,"v-combobox--selecting-index":J.value>-1,["v-combobox--"+(v.multiple?"multiple":"single")]:!0},v.class],style:v.style,readonly:oe.isReadonly.value,placeholder:l?void 0:v.placeholder,"onClick:clear":ye,"onMousedown:control":ge,onKeydown:Ce}),{...F,default:()=>u(i,null,[u(D,n({ref:$,modelValue:de.value,"onUpdate:modelValue":e=>de.value=e,activator:"parent",contentClass:"v-combobox__content",disabled:me.value,eager:v.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:v.transition,onAfterEnter:De,onAfterLeave:Se},v.menuProps),{default:()=>[e&&u(S,n({ref:xe,selected:be.value,selectStrategy:v.multiple?"independent":"single-independent",onMousedown:e=>e.preventDefault(),onKeydown:je,onFocusin:Ie,onFocusout:Ae,tabindex:"-1","aria-live":"polite",color:v.itemColor??v.color},Ve,v.listProps),{default:()=>{var e,l,t;return[null==(e=F["prepend-item"])?void 0:e.call(F),!ce.value.length&&!v.hideNoData&&((null==(l=F["no-data"])?void 0:l.call(F))??u(w,{key:"no-data",title:B(v.noDataText)},null)),u(I,{ref:q,renderless:!0,items:ce.value,itemKey:"value"},{default:e=>{var l;let{item:t,index:o,itemRef:a}=e;const r=n(t.props,{ref:a,key:t.value,active:!(!he.value||0!==o)||void 0,onClick:()=>we(t,null)});return(null==(l=F.item)?void 0:l.call(F,{item:t,index:o,props:r}))??u(w,n(r,{role:"option"}),{prepend:e=>{let{isSelected:l}=e;return u(i,null,[v.multiple&&!v.hideSelected?u(A,{key:t.value,modelValue:l,ripple:!1,tabindex:"-1"},null):void 0,t.props.prependAvatar&&u(_,{image:t.props.prependAvatar},null),t.props.prependIcon&&u(C,{icon:t.props.prependIcon},null)])},title:()=>{var e;return H.value?t.title:b("v-combobox",t.title,null==(e=se(t))?void 0:e.title)}})}}),null==(t=F["append-item"])?void 0:t.call(F)]}})]}),te.value.map(((e,l)=>{function t(l){l.stopPropagation(),l.preventDefault(),we(e,!1)}const o={"onClick:close":t,onKeydown(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),t(e))},onMousedown(e){e.preventDefault(),e.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},a=ae.value?!!F.chip:!!F.selection,i=a?O(ae.value?F.chip({item:e,index:l,props:o}):F.selection({item:e,index:l})):void 0;if(!a||i)return u("div",{key:e.value,class:["v-combobox__selection",l===J.value&&["v-combobox__selection--selected",ee.value]],style:l===J.value?le.value:{}},[ae.value?F.chip?u(P,{key:"chip-defaults",defaults:{VChip:{closable:v.closableChips,size:"small",text:e.title}}},{default:()=>[i]}):u(E,n({key:"chip",closable:v.closableChips,size:"small",text:e.title,disabled:e.props.disabled},o),null):i??u("span",{class:"v-combobox__selection-text"},[e.title,v.multiple&&l<te.value.length-1&&u("span",{class:"v-combobox__selection-comma"},[r(",")])])])}))]),"append-inner":function(){for(var e,l,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return u(i,null,[null==(e=F["append-inner"])?void 0:e.call(F,...o),v.hideNoData&&!v.items.length||!v.menuIcon?void 0:u(C,{class:"v-combobox__menu-icon",color:null==(l=K.value)?void 0:l.fieldIconColor,icon:v.menuIcon,onMousedown:ke,onClick:T,"aria-label":B(fe.value),title:B(fe.value),tabindex:"-1"},null)])}})})),x({isFocused:z,isPristine:H,menu:de,search:ie,selectionIndex:J,filteredItems:ve,select:we},K)}});export{H as VCombobox,z as makeVComboboxProps};
