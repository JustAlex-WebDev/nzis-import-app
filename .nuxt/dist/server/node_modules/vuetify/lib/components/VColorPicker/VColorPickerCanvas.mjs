import{shallowRef as e,ref as o,computed as t,watch as l,createVNode as r}from"/Users/alexandarvalov/Documents/GitHub/nzis-import-app/node_modules/vue/index.mjs";/* empty css                       */import{makeComponentProps as i}from"../../composables/component.mjs";import{useResizeObserver as a}from"../../composables/resizeObserver.mjs";import{clamp as n,convertToUnit as s,getEventCoordinates as u}from"../../util/helpers.mjs";import{defineComponent as v}from"../../util/defineComponent.mjs";import{propsFactory as d}from"../../util/propsFactory.mjs";import{useRender as c}from"../../util/useRender.mjs";const m=d({color:{type:Object},disabled:Boolean,dotSize:{type:[Number,String],default:10},height:{type:[Number,String],default:150},width:{type:[Number,String],default:300},...i()},"VColorPickerCanvas"),p=v({name:"VColorPickerCanvas",props:m(),emits:{"update:color":e=>!0,"update:position":e=>!0},setup(i,v){let{emit:d}=v;const m=e(!1),p=o(),h=e(parseFloat(i.width)),f=e(parseFloat(i.height)),y=o({x:0,y:0}),g=t({get:()=>y.value,set(e){var o,t;if(!p.value)return;const{x:l,y:r}=e;y.value=e,d("update:color",{h:(null==(o=i.color)?void 0:o.h)??0,s:n(l,0,h.value)/h.value,v:1-n(r,0,f.value)/f.value,a:(null==(t=i.color)?void 0:t.a)??1})}}),b=t((()=>{const{x:e,y:o}=g.value,t=parseInt(i.dotSize,10)/2;return{width:s(i.dotSize),height:s(i.dotSize),transform:`translate(${s(e-t)}, ${s(o-t)})`}})),{resizeRef:C}=a();function S(e){"mousedown"===e.type&&e.preventDefault(),i.disabled||(x(e),(void 0).addEventListener("mousemove",x),(void 0).addEventListener("mouseup",w),(void 0).addEventListener("touchmove",x),(void 0).addEventListener("touchend",w))}function x(e){if(i.disabled||!p.value)return;m.value=!0;const o=u(e);!function(e,o,t){const{left:l,top:r,width:i,height:a}=t;g.value={x:n(e-l,0,i),y:n(o-r,0,a)}}(o.clientX,o.clientY,p.value.getBoundingClientRect())}function w(){(void 0).removeEventListener("mousemove",x),(void 0).removeEventListener("mouseup",w),(void 0).removeEventListener("touchmove",x),(void 0).removeEventListener("touchend",w)}function L(){var e;if(!p.value)return;const o=p.value,t=o.getContext("2d");if(!t)return;const l=t.createLinearGradient(0,0,o.width,0);l.addColorStop(0,"hsla(0, 0%, 100%, 1)"),l.addColorStop(1,`hsla(${(null==(e=i.color)?void 0:e.h)??0}, 100%, 50%, 1)`),t.fillStyle=l,t.fillRect(0,0,o.width,o.height);const r=t.createLinearGradient(0,0,0,o.height);r.addColorStop(0,"hsla(0, 0%, 0%, 0)"),r.addColorStop(1,"hsla(0, 0%, 0%, 1)"),t.fillStyle=r,t.fillRect(0,0,o.width,o.height)}return l((()=>{var e;return null==(e=i.color)?void 0:e.h}),L,{immediate:!0}),l((()=>[h.value,f.value]),((e,o)=>{L(),y.value={x:g.value.x*e[0]/o[0],y:g.value.y*e[1]/o[1]}}),{flush:"post"}),l((()=>i.color),(()=>{m.value?m.value=!1:y.value=i.color?{x:i.color.s*h.value,y:(1-i.color.v)*f.value}:{x:0,y:0}}),{deep:!0,immediate:!0}),c((()=>r("div",{ref:C,class:["v-color-picker-canvas",i.class],style:i.style,onMousedown:S,onTouchstartPassive:S},[r("canvas",{ref:p,width:h.value,height:f.value},null),i.color&&r("div",{class:["v-color-picker-canvas__dot",{"v-color-picker-canvas__dot--disabled":i.disabled}],style:b.value},null)]))),{}}});export{p as VColorPickerCanvas,m as makeVColorPickerCanvasProps};
