import{ref as e,shallowRef as l,computed as t,watch as a,nextTick as o,createVNode as u,mergeProps as n,Fragment as i,createTextVNode as r}from"/Users/alexandarvalov/Documents/GitHub/nzis-import-app/node_modules/vue/index.mjs";/* empty css                  */import{makeSelectProps as s}from"../VSelect/VSelect.mjs";import{makeVTextFieldProps as v,VTextField as c}from"../VTextField/VTextField.mjs";import{useScrolling as p}from"../VSelect/useScrolling.mjs";import{useTextColor as m}from"../../composables/color.mjs";import{useFilter as d,makeFilterProps as f,highlightResult as h}from"../../composables/filter.mjs";import{useForm as V}from"../../composables/form.mjs";import{forwardRefs as g}from"../../composables/forwardRefs.mjs";import{useItems as y}from"../../composables/list-items.mjs";import{useLocale as x}from"../../composables/locale.mjs";import{useProxiedModel as b}from"../../composables/proxiedModel.mjs";import{makeTransitionProps as k}from"../../composables/transition.mjs";import{VIcon as j}from"../VIcon/VIcon.mjs";import{omit as C,wrapInArray as S,noop as D,ensureValidVNode as w,checkPrintable as A,matchesSelector as I,deepEqual as _}from"../../util/helpers.mjs";import{VMenu as P}from"../VMenu/VMenu.mjs";import{VList as F}from"../VList/VList.mjs";import{VListItem as R}from"../VList/VListItem.mjs";import{VVirtualScroll as M}from"../VVirtualScroll/VVirtualScroll.mjs";import{VCheckboxBtn as T}from"../VCheckbox/VCheckboxBtn.mjs";import{VAvatar as E}from"../VAvatar/VAvatar.mjs";import{VChip as L}from"../VChip/VChip.mjs";import{VDefaultsProvider as O}from"../VDefaultsProvider/VDefaultsProvider.mjs";import{genericComponent as U}from"../../util/defineComponent.mjs";import{propsFactory as B}from"../../util/propsFactory.mjs";import{useRender as K}from"../../util/useRender.mjs";const z=B({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...f({filterKeys:["title"]}),...s(),...C(v({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...k({transition:!1})},"VAutocomplete"),N=U()({name:"VAutocomplete",props:z(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(s,v){let{slots:f}=v;const{t:k}=x(),C=e(),U=l(!1),B=l(!0),z=l(!1),N=e(),H=e(),G=l(-1),q=t((()=>{var e;return null==(e=C.value)?void 0:e.color})),{items:J,transformIn:Q,transformOut:W}=y(s),{textColorClasses:X,textColorStyles:Y}=m(q),Z=b(s,"search",""),$=b(s,"modelValue",[],(e=>Q(null===e?[null]:S(e))),(e=>{const l=W(e);return s.multiple?l:l[0]??null})),ee=t((()=>"function"==typeof s.counterValue?s.counterValue($.value):"number"==typeof s.counterValue?s.counterValue:$.value.length)),le=V(s),{filteredItems:te,getMatches:ae}=d(s,J,(()=>B.value?"":Z.value)),oe=t((()=>s.hideSelected?te.value.filter((e=>!$.value.some((l=>l.value===e.value)))):te.value)),ue=t((()=>!(!s.chips&&!f.chip))),ne=t((()=>ue.value||!!f.selection)),ie=t((()=>$.value.map((e=>e.props.value)))),re=t((()=>{var e;return(!0===s.autoSelectFirst||"exact"===s.autoSelectFirst&&Z.value===(null==(e=oe.value[0])?void 0:e.title))&&oe.value.length>0&&!B.value&&!z.value})),se=t((()=>s.hideNoData&&!oe.value.length||le.isReadonly.value||le.isDisabled.value)),ve=b(s,"menu"),ce=t({get:()=>ve.value,set:e=>{var l;ve.value&&!e&&(null==(l=N.value)?void 0:l.Î¨openChildren.size)||e&&se.value||(ve.value=e)}}),pe=t((()=>ce.value?s.closeText:s.openText)),me=e(),de=p(me,C);function fe(e){s.openOnClear&&(ce.value=!0),Z.value=""}function he(){se.value||(ce.value=!0)}function Ve(e){se.value||(U.value&&(e.preventDefault(),e.stopPropagation()),ce.value=!ce.value)}function ge(e){var l;" "!==e.key&&A(e)&&(null==(l=C.value)||l.focus())}function ye(e){var l,t,a,o,u;if(le.isReadonly.value)return;const n=null==(l=C.value)?void 0:l.selectionStart,i=$.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(ce.value=!0),["Escape"].includes(e.key)&&(ce.value=!1),re.value&&["Enter","Tab"].includes(e.key)&&!$.value.some((e=>{let{value:l}=e;return l===oe.value[0].value}))&&we(oe.value[0]),"ArrowDown"===e.key&&re.value&&(null==(t=me.value)||t.focus("next")),["Backspace","Delete"].includes(e.key)){if(!s.multiple&&ne.value&&$.value.length>0&&!Z.value)return we($.value[0],!1);if(~G.value){e.preventDefault();const l=G.value;we($.value[G.value],!1),G.value=l>=i-1?i-2:l}else"Backspace"!==e.key||Z.value||(G.value=i-1)}else if(s.multiple)if("ArrowLeft"===e.key){if(G.value<0&&n&&n>0)return;const e=G.value>-1?G.value-1:i-1;if($.value[e])G.value=e;else{const e=(null==(a=Z.value)?void 0:a.length)??null;G.value=-1,null==(o=C.value)||o.setSelectionRange(e,e)}}else if("ArrowRight"===e.key){if(G.value<0)return;const e=G.value+1;$.value[e]?G.value=e:(G.value=-1,null==(u=C.value)||u.setSelectionRange(0,0))}else~G.value&&A(e)&&(G.value=-1)}function xe(e){if(I(C.value)||I(C.value)){const l=J.value.find((l=>l.title===e.target.value));l&&we(l)}}function be(){var e;s.eager&&(null==(e=H.value)||e.calculateVisibleItems())}function ke(){var e;U.value&&(B.value=!0,null==(e=C.value)||e.focus())}function je(e){U.value=!0,setTimeout((()=>{z.value=!0}))}function Ce(e){z.value=!1}function Se(e){null!=e&&(""!==e||s.multiple||ne.value)||($.value=[])}const De=l(!1);function we(e){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&!e.props.disabled)if(s.multiple){const t=$.value.findIndex((l=>(s.valueComparator||_)(l.value,e.value))),a=null==l?!~t:l;if(~t){const l=a?[...$.value,e]:[...$.value];l.splice(t,1),$.value=l}else a&&($.value=[...$.value,e]);s.clearOnSelect&&(Z.value="")}else{const t=!1!==l;$.value=t?[e]:[],Z.value=t&&!ne.value?e.title:"",o((()=>{ce.value=!1,B.value=!0}))}}return a(U,((e,l)=>{var t;e!==l&&(e?(De.value=!0,Z.value=s.multiple||ne.value?"":String((null==(t=$.value.at(-1))?void 0:t.props.title)??""),B.value=!0,o((()=>De.value=!1))):(s.multiple||null!=Z.value||($.value=[]),ce.value=!1,(s.multiple||ne.value)&&(Z.value=""),G.value=-1))})),a(Z,(e=>{U.value&&!De.value&&(e&&(ce.value=!0),B.value=!e)})),a(ce,(()=>{!s.hideSelected&&ce.value&&$.value.length&&oe.value.findIndex((e=>$.value.some((l=>e.value===l.value))))})),a((()=>s.items),((e,l)=>{ce.value||U.value&&!l.length&&e.length&&(ce.value=!0)})),K((()=>{const e=!!(!s.hideNoData||oe.value.length||f["prepend-item"]||f["append-item"]||f["no-data"]),l=$.value.length>0,t=c.filterProps(s);return u(c,n({ref:C},t,{modelValue:Z.value,"onUpdate:modelValue":[e=>Z.value=e,Se],focused:U.value,"onUpdate:focused":e=>U.value=e,validationValue:$.externalValue,counterValue:ee.value,dirty:l,onChange:xe,class:["v-autocomplete","v-autocomplete--"+(s.multiple?"multiple":"single"),{"v-autocomplete--active-menu":ce.value,"v-autocomplete--chips":!!s.chips,"v-autocomplete--selection-slot":!!ne.value,"v-autocomplete--selecting-index":G.value>-1},s.class],style:s.style,readonly:le.isReadonly.value,placeholder:l?void 0:s.placeholder,"onClick:clear":fe,"onMousedown:control":he,onKeydown:ye}),{...f,default:()=>u(i,null,[u(P,n({ref:N,modelValue:ce.value,"onUpdate:modelValue":e=>ce.value=e,activator:"parent",contentClass:"v-autocomplete__content",disabled:se.value,eager:s.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:s.transition,onAfterEnter:be,onAfterLeave:ke},s.menuProps),{default:()=>[e&&u(F,n({ref:me,selected:ie.value,selectStrategy:s.multiple?"independent":"single-independent",onMousedown:e=>e.preventDefault(),onKeydown:ge,onFocusin:je,onFocusout:Ce,tabindex:"-1","aria-live":"polite",color:s.itemColor??s.color},de,s.listProps),{default:()=>{var e,l,t;return[null==(e=f["prepend-item"])?void 0:e.call(f),!oe.value.length&&!s.hideNoData&&((null==(l=f["no-data"])?void 0:l.call(f))??u(R,{key:"no-data",title:k(s.noDataText)},null)),u(M,{ref:H,renderless:!0,items:oe.value,itemKey:"value"},{default:e=>{var l;let{item:t,index:a,itemRef:o}=e;const r=n(t.props,{ref:o,key:t.value,active:!(!re.value||0!==a)||void 0,onClick:()=>we(t,null)});return(null==(l=f.item)?void 0:l.call(f,{item:t,index:a,props:r}))??u(R,n(r,{role:"option"}),{prepend:e=>{let{isSelected:l}=e;return u(i,null,[s.multiple&&!s.hideSelected?u(T,{key:t.value,modelValue:l,ripple:!1,tabindex:"-1"},null):void 0,t.props.prependAvatar&&u(E,{image:t.props.prependAvatar},null),t.props.prependIcon&&u(j,{icon:t.props.prependIcon},null)])},title:()=>{var e;return B.value?t.title:h("v-autocomplete",t.title,null==(e=ae(t))?void 0:e.title)}})}}),null==(t=f["append-item"])?void 0:t.call(f)]}})]}),$.value.map(((e,l)=>{function t(l){l.stopPropagation(),l.preventDefault(),we(e,!1)}const a={"onClick:close":t,onKeydown(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),t(e))},onMousedown(e){e.preventDefault(),e.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},o=ue.value?!!f.chip:!!f.selection,i=o?w(ue.value?f.chip({item:e,index:l,props:a}):f.selection({item:e,index:l})):void 0;if(!o||i)return u("div",{key:e.value,class:["v-autocomplete__selection",l===G.value&&["v-autocomplete__selection--selected",X.value]],style:l===G.value?Y.value:{}},[ue.value?f.chip?u(O,{key:"chip-defaults",defaults:{VChip:{closable:s.closableChips,size:"small",text:e.title}}},{default:()=>[i]}):u(L,n({key:"chip",closable:s.closableChips,size:"small",text:e.title,disabled:e.props.disabled},a),null):i??u("span",{class:"v-autocomplete__selection-text"},[e.title,s.multiple&&l<$.value.length-1&&u("span",{class:"v-autocomplete__selection-comma"},[r(",")])])])}))]),"append-inner":function(){for(var e,l,t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return u(i,null,[null==(e=f["append-inner"])?void 0:e.call(f,...a),s.menuIcon?u(j,{class:"v-autocomplete__menu-icon",color:null==(l=C.value)?void 0:l.fieldIconColor,icon:s.menuIcon,onMousedown:Ve,onClick:D,"aria-label":k(pe.value),title:k(pe.value),tabindex:"-1"},null):void 0])}})})),g({isFocused:U,isPristine:B,menu:ce,search:Z,filteredItems:te,select:we},C)}});export{N as VAutocomplete,z as makeVAutocompleteProps};
