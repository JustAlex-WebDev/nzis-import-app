import{toRef as e,shallowRef as r,ref as l,computed as t,watch as a,nextTick as o,withDirectives as i,createVNode as s,mergeProps as n,Fragment as u,resolveDirective as c,vShow as v}from"/Users/alexandarvalov/Documents/GitHub/nzis-import-app/node_modules/vue/index.mjs";/* empty css         */import{makeVResponsiveProps as m,VResponsive as d}from"../VResponsive/VResponsive.mjs";import{useBackgroundColor as g}from"../../composables/color.mjs";import{makeComponentProps as p}from"../../composables/component.mjs";import{useRounded as f,makeRoundedProps as S}from"../../composables/rounded.mjs";import{makeTransitionProps as y,MaybeTransition as b}from"../../composables/transition.mjs";import{Intersect as _}from"../../directives/intersect/index.mjs";import{genericComponent as h}from"../../util/defineComponent.mjs";import{propsFactory as j}from"../../util/propsFactory.mjs";import{getCurrentInstance as z}from"../../util/getCurrentInstance.mjs";import{useRender as I}from"../../util/useRender.mjs";import{convertToUnit as C}from"../../util/helpers.mjs";const R=j({absolute:Boolean,alt:String,cover:Boolean,color:String,draggable:{type:[Boolean,String],default:void 0},eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},crossorigin:String,referrerpolicy:String,srcset:String,position:String,...m(),...p(),...S(),...y()},"VImg"),V=h()({name:"VImg",directives:{intersect:_},props:R(),emits:{loadstart:e=>!0,load:e=>!0,error:e=>!0},setup(m,p){let{emit:S,slots:y}=p;const{backgroundColorClasses:_,backgroundColorStyles:h}=g(e(m,"color")),{roundedClasses:j}=f(m),R=z("VImg"),V=r(""),x=l(),U=r(m.eager?"loading":"idle"),W=r(),w=r(),B=t((()=>m.src&&"object"==typeof m.src?{src:m.src.src,srcset:m.srcset||m.src.srcset,lazySrc:m.lazySrc||m.src.lazySrc,aspect:Number(m.aspectRatio||m.src.aspect||0)}:{src:m.src,srcset:m.srcset,lazySrc:m.lazySrc,aspect:Number(m.aspectRatio||0)})),k=t((()=>B.value.aspect||W.value/w.value||0));function F(e){if(!m.eager||!e){if(U.value="loading",B.value.lazySrc){const e=new Image;e.src=B.value.lazySrc,A(e,null)}B.value.src&&o((()=>{var e;S("loadstart",(null==(e=x.value)?void 0:e.currentSrc)||B.value.src),setTimeout((()=>{var e;if(!R.isUnmounted)if(null==(e=x.value)?void 0:e.complete){if(x.value.naturalWidth||P(),"error"===U.value)return;k.value||A(x.value,null),"loading"===U.value&&H()}else k.value||A(x.value),T()}))}))}}function H(){var e;R.isUnmounted||(T(),A(x.value),U.value="loaded",S("load",(null==(e=x.value)?void 0:e.currentSrc)||B.value.src))}function P(){var e;R.isUnmounted||(U.value="error",S("error",(null==(e=x.value)?void 0:e.currentSrc)||B.value.src))}function T(){const e=x.value;e&&(V.value=e.currentSrc||e.src)}a((()=>m.src),(()=>{F("idle"!==U.value)})),a(k,((e,r)=>{!e&&r&&x.value&&A(x.value)}));let q=-1;function A(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;const l=()=>{if(clearTimeout(q),R.isUnmounted)return;const{naturalHeight:t,naturalWidth:a}=e;t||a?(W.value=a,w.value=t):e.complete||"loading"!==U.value||null==r?(e.currentSrc.endsWith(".svg")||e.currentSrc.startsWith("data:image/svg+xml"))&&(W.value=1,w.value=1):q=(void 0).setTimeout(l,r)};l()}const N=t((()=>({"v-img__img--cover":m.cover,"v-img__img--contain":!m.cover}))),O=()=>{var e;if(!B.value.src||"idle"===U.value)return null;const r=s("img",{class:["v-img__img",N.value],style:{objectPosition:m.position},crossorigin:m.crossorigin,src:B.value.src,srcset:B.value.srcset,alt:m.alt,referrerpolicy:m.referrerpolicy,draggable:m.draggable,sizes:m.sizes,ref:x,onLoad:H,onError:P},null),l=null==(e=y.sources)?void 0:e.call(y);return s(b,{transition:m.transition,appear:!0},{default:()=>[i(l?s("picture",{class:"v-img__picture"},[l,r]):r,[[v,"loaded"===U.value]])]})},D=()=>s(b,{transition:m.transition},{default:()=>[B.value.lazySrc&&"loaded"!==U.value&&s("img",{class:["v-img__img","v-img__img--preload",N.value],style:{objectPosition:m.position},crossorigin:m.crossorigin,src:B.value.lazySrc,alt:m.alt,referrerpolicy:m.referrerpolicy,draggable:m.draggable},null)]}),E=()=>y.placeholder?s(b,{transition:m.transition,appear:!0},{default:()=>[("loading"===U.value||"error"===U.value&&!y.error)&&s("div",{class:"v-img__placeholder"},[y.placeholder()])]}):null,G=()=>y.error?s(b,{transition:m.transition,appear:!0},{default:()=>["error"===U.value&&s("div",{class:"v-img__error"},[y.error()])]}):null,L=()=>m.gradient?s("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${m.gradient})`}},null):null,M=r(!1);{const e=a(k,(r=>{r&&(requestAnimationFrame((()=>{requestAnimationFrame((()=>{M.value=!0}))})),e())}))}return I((()=>{const e=d.filterProps(m);return i(s(d,n({class:["v-img",{"v-img--absolute":m.absolute,"v-img--booting":!M.value},_.value,j.value,m.class],style:[{width:C("auto"===m.width?W.value:m.width)},h.value,m.style]},e,{aspectRatio:k.value,"aria-label":m.alt,role:m.alt?"img":void 0}),{additional:()=>s(u,null,[s(O,null,null),s(D,null,null),s(L,null,null),s(E,null,null),s(G,null,null)]),default:y.default}),[[c("intersect"),{handler:F,options:m.options},null,{once:!0}]])})),{currentSrc:V,image:x,state:U,naturalWidth:W,naturalHeight:w}}});export{V as VImg,R as makeVImgProps};
