import{ref as e,computed as t,watch as o,onScopeDispose as r,nextTick as i}from"/Users/alexandarvalov/Documents/GitHub/nzis-import-app/node_modules/vue/index.mjs";import{anchorToPoint as a,getOffset as n}from"./util/point.mjs";import{getTargetBox as l,Box as s,getOverflow as c}from"../../util/box.mjs";import{isFixedPosition as f}from"../../util/isFixedPosition.mjs";import{parseAnchor as u,flipSide as m,flipAlign as h,flipCorner as v,getAxis as y}from"../../util/anchor.mjs";import{getScrollParents as d}from"../../util/getScrollParent.mjs";import{propsFactory as g}from"../../util/propsFactory.mjs";import{destructComputed as p,convertToUnit as x,clamp as b}from"../../util/helpers.mjs";import{consoleError as w}from"../../util/console.mjs";import{nullifyTransforms as A}from"../../util/animation.mjs";const F={static:function(){},connected:function(e,g,F){(Array.isArray(e.target.value)||f(e.target.value))&&Object.assign(F.value,{position:"fixed",top:0,[e.isRtl.value?"right":"left"]:0});const{preferredAnchor:j,preferredOrigin:E}=p((()=>{const t=u(g.location,e.isRtl.value),o="overlap"===g.origin?t:"auto"===g.origin?m(t):u(g.origin,e.isRtl.value);return t.side===o.side&&t.align===h(o).align?{preferredAnchor:v(t),preferredOrigin:v(o)}:{preferredAnchor:t,preferredOrigin:o}})),[k,O,P,S]=["minWidth","minHeight","maxWidth","maxHeight"].map((e=>t((()=>{const t=parseFloat(g[e]);return isNaN(t)?1/0:t})))),H=t((()=>{if(Array.isArray(g.offset))return g.offset;if("string"==typeof g.offset){const e=g.offset.split(" ").map(parseFloat);return e.length<2&&e.push(0),e}return"number"==typeof g.offset?[g.offset,0]:[0,0]}));let W=!1;const $=new ResizeObserver((()=>{W&&q()}));function q(){if(W=!1,requestAnimationFrame((()=>W=!0)),!e.target.value||!e.contentEl.value)return;const t=l(e.target.value),o=function(e,t){const o=A(e);t?o.x+=parseFloat(e.style.right||0):o.x-=parseFloat(e.style.left||0);return o.y-=parseFloat(e.style.top||0),o}(e.contentEl.value,e.isRtl.value),r=d(e.contentEl.value);r.length||(r.push((void 0).documentElement),e.contentEl.value.style.top&&e.contentEl.value.style.left||(o.x-=parseFloat((void 0).documentElement.style.getPropertyValue("--v-body-scroll-x")||0),o.y-=parseFloat((void 0).documentElement.style.getPropertyValue("--v-body-scroll-y")||0)));const i=r.reduce(((e,t)=>{const o=t.getBoundingClientRect(),r=new s({x:t===(void 0).documentElement?0:o.x,y:t===(void 0).documentElement?0:o.y,width:t.clientWidth,height:t.clientHeight});return e?new s({x:Math.max(e.left,r.left),y:Math.max(e.top,r.top),width:Math.min(e.right,r.right)-Math.max(e.left,r.left),height:Math.min(e.bottom,r.bottom)-Math.max(e.top,r.top)}):r}),void 0);i.x+=12,i.y+=12,i.width-=24,i.height-=24;let f={anchor:j.value,origin:E.value};function u(e){const r=new s(o),l=a(e.anchor,t),f=a(e.origin,r);let{x:u,y:m}=n(l,f);switch(e.anchor.side){case"top":m-=H.value[0];break;case"bottom":m+=H.value[0];break;case"left":u-=H.value[0];break;case"right":u+=H.value[0]}switch(e.anchor.align){case"top":m-=H.value[1];break;case"bottom":m+=H.value[1];break;case"left":u-=H.value[1];break;case"right":u+=H.value[1]}r.x+=u,r.y+=m,r.width=Math.min(r.width,P.value),r.height=Math.min(r.height,S.value);return{overflows:c(r,i),x:u,y:m}}let v=0,g=0;const p={x:0,y:0},$={x:!1,y:!1};let q=-1;for(;;){if(q++>10){w("Infinite loop detected in connectedLocationStrategy");break}const{x:e,y:t,overflows:r}=u(f);v+=e,g+=t,o.x+=e,o.y+=t;{const e=y(f.anchor),t=r.x.before||r.x.after,o=r.y.before||r.y.after;let i=!1;if(["x","y"].forEach((a=>{if("x"===a&&t&&!$.x||"y"===a&&o&&!$.y){const t={anchor:{...f.anchor},origin:{...f.origin}},o="x"===a?"y"===e?h:m:"y"===e?m:h;t.anchor=o(t.anchor),t.origin=o(t.origin);const{overflows:n}=u(t);(n[a].before<=r[a].before&&n[a].after<=r[a].after||n[a].before+n[a].after<(r[a].before+r[a].after)/2)&&(f=t,i=$[a]=!0)}})),i)continue}r.x.before&&(v+=r.x.before,o.x+=r.x.before),r.x.after&&(v-=r.x.after,o.x-=r.x.after),r.y.before&&(g+=r.y.before,o.y+=r.y.before),r.y.after&&(g-=r.y.after,o.y-=r.y.after);{const e=c(o,i);p.x=i.width-e.x.before-e.x.after,p.y=i.height-e.y.before-e.y.after,v+=e.x.before,o.x+=e.x.before,g+=e.y.before,o.y+=e.y.before}break}const B=y(f.anchor);return Object.assign(F.value,{"--v-overlay-anchor-origin":`${f.anchor.side} ${f.anchor.align}`,transformOrigin:`${f.origin.side} ${f.origin.align}`,top:x(R(g)),left:e.isRtl.value?void 0:x(R(v)),right:e.isRtl.value?x(R(-v)):void 0,minWidth:x("y"===B?Math.min(k.value,t.width):k.value),maxWidth:x(M(b(p.x,k.value===1/0?0:k.value,P.value))),maxHeight:x(M(b(p.y,O.value===1/0?0:O.value,S.value)))}),{available:p,contentBox:o}}return o([e.target,e.contentEl],((e,t)=>{let[o,r]=e,[i,a]=t;i&&!Array.isArray(i)&&$.unobserve(i),o&&!Array.isArray(o)&&$.observe(o),a&&$.unobserve(a),r&&$.observe(r)}),{immediate:!0}),r((()=>{$.disconnect()})),o((()=>[j.value,E.value,g.offset,g.minWidth,g.minHeight,g.maxWidth,g.maxHeight]),(()=>q())),i((()=>{const e=q();if(!e)return;const{available:t,contentBox:o}=e;o.height>t.y&&requestAnimationFrame((()=>{q(),requestAnimationFrame((()=>{q()}))}))})),{updateLocation:q}}},j=g({locationStrategy:{type:[String,Function],default:"static",validator:e=>"function"==typeof e||e in F},location:{type:String,default:"bottom"},origin:{type:String,default:"auto"},offset:[Number,String,Array]},"VOverlay-location-strategies");function E(t,o){return{contentStyles:e({}),updateLocation:e()}}function R(e){return Math.round(e*devicePixelRatio)/devicePixelRatio}function M(e){return Math.ceil(e*devicePixelRatio)/devicePixelRatio}export{j as makeLocationStrategyProps,E as useLocationStrategies};
