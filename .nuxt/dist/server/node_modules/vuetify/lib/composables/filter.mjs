import{shallowRef as e,computed as t,unref as n,watchEffect as l,createVNode as o,Fragment as i}from"/Users/alexandarvalov/Documents/GitHub/nzis-import-app/node_modules/vue/index.mjs";import{propsFactory as r}from"../util/propsFactory.mjs";import{wrapInArray as s,getPropertyFromItem as u}from"../util/helpers.mjs";const c=(e,t,n)=>{if(null==e||null==t)return-1;e=e.toString().toLocaleLowerCase(),t=t.toString().toLocaleLowerCase();const l=[];let o=e.indexOf(t);for(;~o;)l.push([o,o+t.length]),o=e.indexOf(t,o+t.length);return l.length?l:-1};function f(e,t){if(null!=e&&"boolean"!=typeof e&&-1!==e)return"number"==typeof e?[[e,t.length]]:Array.isArray(e[0])?e:[e]}const a=r({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function m(e,t,n){var l;const o=[],i=(null==n?void 0:n.default)??c,r=!!(null==n?void 0:n.filterKeys)&&s(n.filterKeys),a=Object.keys((null==n?void 0:n.customKeyFilter)??{}).length;if(!(null==e?void 0:e.length))return o;e:for(let c=0;c<e.length;c++){const[m,d=m]=s(e[c]),p={},y={};let v=-1;if((t||a>0)&&!(null==n?void 0:n.noFilter)){if("object"==typeof m){const e=r||Object.keys(d);for(const o of e){const e=u(d,o),r=null==(l=null==n?void 0:n.customKeyFilter)?void 0:l[o];if(v=r?r(e,t,m):i(e,t,m),-1!==v&&!1!==v)r?p[o]=f(v,t):y[o]=f(v,t);else if("every"===(null==n?void 0:n.filterMode))continue e}}else v=i(m,t,m),-1!==v&&!1!==v&&(y.title=f(v,t));const e=Object.keys(y).length,o=Object.keys(p).length;if(!e&&!o)continue;if("union"===(null==n?void 0:n.filterMode)&&o!==a&&!e)continue;if("intersection"===(null==n?void 0:n.filterMode)&&(o!==a||!e))continue}o.push({index:c,matches:{...y,...p}})}return o}function d(o,i,r,s){const u=e([]),c=e(new Map),f=t((()=>(null==s?void 0:s.transform)?n(i).map((e=>[e,s.transform(e)])):n(i)));return l((()=>{const e="function"==typeof r?r():n(r),t="string"!=typeof e&&"number"!=typeof e?"":String(e),l=m(f.value,t,{customKeyFilter:{...o.customKeyFilter,...n(null==s?void 0:s.customKeyFilter)},default:o.customFilter,filterKeys:o.filterKeys,filterMode:o.filterMode,noFilter:o.noFilter}),a=n(i),d=[],p=new Map;l.forEach((e=>{let{index:t,matches:n}=e;const l=a[t];d.push(l),p.set(l.value,n)})),u.value=d,c.value=p})),{filteredItems:u,filteredMatches:c,getMatches:function(e){return c.value.get(e.value)}}}function p(e,t,n){return null!=n&&n.length?n.map(((l,r)=>{const s=0===r?0:n[r-1][1],u=[o("span",{class:`${e}__unmask`},[t.slice(s,l[0])]),o("span",{class:`${e}__mask`},[t.slice(l[0],l[1])])];return r===n.length-1&&u.push(o("span",{class:`${e}__unmask`},[t.slice(l[1])])),o(i,null,[u])})):t}export{c as defaultFilter,m as filterItems,p as highlightResult,a as makeFilterProps,d as useFilter};
