import{useDisplay as e}from"./display.mjs";import{useResizeObserver as t}from"./resizeObserver.mjs";import{shallowRef as l,watchEffect as a,ref as n,computed as u,watch as r,onScopeDispose as o,nextTick as i}from"/Users/alexandarvalov/Documents/GitHub/nzis-import-app/node_modules/vue/index.mjs";import{debounce as v,clamp as m,getPropertyFromItem as c}from"../util/helpers.mjs";import{propsFactory as s}from"../util/propsFactory.mjs";const h=s({itemHeight:{type:[Number,String],default:null},itemKey:{type:[String,Array,Function],default:null},height:[Number,String]},"virtual");function f(s,h){const f=e(),p=l(0);a((()=>{p.value=parseFloat(s.itemHeight||0)}));const g=l(0),d=l(Math.ceil((parseInt(s.height)||f.height.value)/(p.value||16))||1),y=l(0),T=l(0),x=n(),A=n();let M=0;const{resizeRef:F,contentRect:I}=t();a((()=>{F.value=x.value}));const b=u((()=>{var e;return x.value===(void 0).documentElement?f.height.value:(null==(e=I.value)?void 0:e.height)||parseInt(s.height)||0})),j=u((()=>!!(x.value&&A.value&&b.value&&p.value)));let R=Array.from({length:h.value.length}),S=Array.from({length:h.value.length});const w=l(0);let z=-1;const H=v((()=>{const e=performance.now();S[0]=0;const t=h.value.length;for(let l=1;l<=t-1;l++)S[l]=(S[l-1]||0)+(R[l-1]||p.value);w.value=Math.max(w.value,performance.now()-e)}),w),k=r(j,(e=>{e&&(k(),M=A.value.offsetTop,H.immediate(),U(),~z&&i((()=>{})))}));function q(e){return e=m(e,0,h.value.length-1),S[e]||0}function K(e){return function(e,t){let l=e.length-1,a=0,n=0,u=null,r=-1;if(e[l]<t)return l;for(;a<=l;)if(n=a+l>>1,u=e[n],u>t)l=n-1;else{if(!(u<t))return u===t?n:a;r=n,a=n+1}return r}(S,e)}o((()=>{H.clear()}));let N=0,B=0,D=0;r(b,((e,t)=>{t&&(U(),e<t&&requestAnimationFrame((()=>{B=0,U()})))}));let E=-1;function G(){x.value&&A.value&&(B=0,D=0,(void 0).clearTimeout(E),U())}let O=-1;function U(){cancelAnimationFrame(O),O=requestAnimationFrame(V)}function V(){if(!x.value||!b.value)return;const e=N-M,t=Math.sign(B),l=Math.max(0,e-100),a=m(K(l),0,h.value.length),n=e+b.value+100,u=m(K(n)+1,a+1,h.value.length);if((-1!==t||a<g.value)&&(1!==t||u>d.value)){const e=q(g.value)-q(a),t=q(u)-q(d.value);Math.max(e,t)>100?(g.value=a,d.value=u):(a<=0&&(g.value=a),u>=h.value.length&&(d.value=u))}y.value=q(g.value),T.value=q(h.value.length)-q(d.value)}const _=u((()=>h.value.slice(g.value,d.value).map(((e,t)=>{const l=t+g.value;return{raw:e,index:l,key:c(e,s.itemKey,l)}}))));return r(h,(()=>{R=Array.from({length:h.value.length}),S=Array.from({length:h.value.length}),H.immediate(),U()}),{deep:1}),{calculateVisibleItems:U,containerRef:x,markerRef:A,computedItems:_,paddingTop:y,paddingBottom:T,scrollToIndex:function(e){const t=q(e);!x.value||e&&!t?z=e:x.value.scrollTop=t},handleScroll:function(){if(!x.value||!A.value)return;const e=x.value.scrollTop,t=performance.now();t-D>500?(B=Math.sign(e-N),M=A.value.offsetTop):B=e-N,N=e,D=t,(void 0).clearTimeout(E),E=(void 0).setTimeout(G,500),U()},handleScrollend:G,handleItemResize:function(e,t){const l=R[e],a=p.value;p.value=a?Math.min(p.value,t):t,l===t&&a===p.value||(R[e]=t,H())}}}export{h as makeVirtualProps,f as useVirtual};
